<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>13.整洁架构 - P3的Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="p3p3pp3"><meta name=description content="原文：https://herbertograca.com/2017/09/28/clean-architecture-standing-on"><meta name=keywords content="P3,blog,coding"><meta name=baidu-site-verification content="code-rMlGvJbrZW"><meta name=google-site-verification content="iTJj3dp57yfylJL_-Z2_nwxz5Dz6jnf1xAwgKb6TS_g"><meta name=generator content="Hugo 0.109.0 with theme even"><link rel=canonical href=https://p3p3pp3.github.io/post/2021/software-architecture/13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="13.整洁架构"><meta property="og:description" content="原文：https://herbertograca.com/2017/09/28/clean-architecture-standing-on"><meta property="og:type" content="article"><meta property="og:url" content="https://p3p3pp3.github.io/post/2021/software-architecture/13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-16T14:00:41+08:00"><meta property="article:modified_time" content="2021-05-16T14:00:41+08:00"><meta itemprop=name content="13.整洁架构"><meta itemprop=description content="原文：https://herbertograca.com/2017/09/28/clean-architecture-standing-on"><meta itemprop=datePublished content="2021-05-16T14:00:41+08:00"><meta itemprop=dateModified content="2021-05-16T14:00:41+08:00"><meta itemprop=wordCount content="2251"><meta itemprop=keywords content="architecture,"><meta name=twitter:card content="summary"><meta name=twitter:title content="13.整洁架构"><meta name=twitter:description content="原文：https://herbertograca.com/2017/09/28/clean-architecture-standing-on"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>P3的Blog</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post.html><li class=mobile-menu-item>Archives</li></a><a href=/tags.html><li class=mobile-menu-item>Tags</li></a><a href=/categories.html><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>P3的Blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post.html>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags.html>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories.html>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>13.整洁架构</h1><div class=post-meta><span class=post-time>2021-05-16</span>
<span class=more-meta>约 2251 字</span>
<span class=more-meta>预计阅读 5 分钟</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#站在-ebi-架构六边形架构和洋葱架构的肩膀上>站在 EBI 架构、六边形架构和洋葱架构的肩膀上</a><ul><li><a href=#外化工具和传达机制>外化工具和传达机制</a></li><li><a href=#依赖方向>依赖方向</a></li><li><a href=#分层>分层</a></li><li><a href=#独立的可测试性>独立的可测试性</a></li></ul></li><li><a href=#站在-mvc-和-ebi-的肩膀上>站在 MVC 和 EBI 的肩膀上</a></li><li><a href=#总结>总结</a></li><li><a href=#引用来源>引用来源</a></li></ul></nav></div></div><div class=post-content><p>原文：https://herbertograca.com/2017/09/28/clean-architecture-standing-on-the-shoulders-of-giants/</p><p><em>这篇文章是
<a href=https://herbertograca.com/2017/07/03/the-software-architecture-chronicles/ target=_blank>软件架构编年史</a>(
<a href=https://www.jianshu.com/p/b477b2cc6cfa target=_blank>译</a>)的一部分，这部编年史由
<a href=https://herbertograca.com/category/development/series/software-architecture/ target=_blank>一系列关于软件架构的文章</a>组成。在这一系列文章中，我将写下我对软件架构的学习和思考，以及我是如何运用这些知识的。如果你阅读了这个系列中之前的文章，本篇文章的的内容将更有意义。</em></p><p>Robert C. Martin(大名鼎鼎的 Uncle Bob)于2012年在
<a href=https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html target=_blank>他的一篇博客</a>中发表了<em>整洁架构</em>的观点，并在一些会议上做了关于该架构的演讲。</p><p>整洁架构借助了许多或熟悉或陌生的概念、规则和模式，说明了如何将它们融会贯通产生出一种构建应用的标准套路。</p><h1 id=站在-ebi-架构六边形架构和洋葱架构的肩膀上>站在 EBI 架构、六边形架构和洋葱架构的肩膀上</h1><p>整洁架构的核心目标与端口和适配器(六边形)架构以及洋葱架构是一致的：</p><ul><li>工具无关</li><li>传达机制无关</li><li>独立的可测试性</li></ul><p>下面这张图发表在整洁架构的博客中，揭示了该架构的总体思路：</p><table><thead><tr><th style=text-align:center><img src=13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.assets/4099-04dfbbf2072ad2af.jpg alt=img></th></tr></thead><tbody><tr><td style=text-align:center>Robert C. Martin 2012,
<a href=https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html target=_blank>The Clean Architecture</a></td></tr></tbody></table><p>正如 Uncle Bob 自己在博客中所说，上面这张图试图将最新的架构观点整合成<em>一个可操作的思路</em>。</p><p>我们来对比一下整洁架构和六边形架构以及洋葱架构的示意图，看看它们在哪些方面是一致的：</p><table><thead><tr><th style=text-align:left><img src=13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.assets/4099-4819b4fd6122ff17.gif alt=img></th><th style=text-align:left><img src=13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.assets/4099-afed900da033889c.png alt=img></th></tr></thead><tbody><tr><td style=text-align:left></td><td style=text-align:left></td></tr></tbody></table><ul><li><h2 id=外化工具和传达机制>外化工具和传达机制</h2></li></ul><p>六边形架构聚焦于使用接口和适配器将工具和传达机制从应用中外化出去。这也是洋葱架构的核心基石之一，就像图中呈现的那样，UI、基础设置和测试全部都在示意图的最外层。整洁架构也有完全一致的特征，UI、Web、DB 等等都在最外层。最终，所有的应用核心代码都是独立于框架/库的。</p><ul><li><h2 id=依赖方向>依赖方向</h2></li></ul><p>六边形架构中并没有明确地告知我们依赖的方向。然而，我们可以轻易地推测出来：应用拥有接口，它们必须由适配器实现或使用。所以适配器依赖接口，依赖位于圆心的应用。外部依赖内部，依赖的方向就指向圆心。在洋葱架构的示意图中，也没有发现关于依赖方向的表示，但是，Jeffrey Palermo 在他的第二篇博客中清楚地表明了<em>所以依赖都指向圆心</em>。整洁架构则非常明确的指出依赖的方向是指向圆心的。它们都在架构层级引入了依赖倒置原则。*内圈不能知道外圈的任何信息。*还有，<em>当数据跨越界限进行传递时，数据总是以最方便内圈使用的格式提供。</em></p><ul><li><h2 id=分层>分层</h2></li></ul><p>六边形架构示意图只展现了两个层次：应用内部和应用外部。而洋葱架构引入了 DDD 中定义的应用层次的混合：控制用例逻辑的应用服务；封装了领域逻辑的领域服务，这些逻辑既不属于实体也不属于值对象；还有实体、值对象等等&mldr;和洋葱架构相比，整洁架构保留了应用服务层(用例)和实体层，当好像漏掉了领域服务层。然而，读过 Uncle Bob 的博客后，我们会发现，他认为任何领域对象都是实体，而非只有 DDD 中的“实体”才是实体：“<em>一个实体可以是一个拥有方法的对象，或者是一组数据结构和函数</em>”。实际上，他为了简化示意图而将最中间的两层合并了。</p><ul><li><h2 id=独立的可测试性>独立的可测试性</h2></li></ul><p>三种架构风格共同遵守的规则，让它们将应用和业务逻辑隔离了出来。这意味着任何情况下我们都可以简单地 mock 外部工具和传达机制，独立地对应用的代码进行测试，而不需要使用数据库或 HTTP 请求。</p><p>正如我们所见，整洁架构包含了六边形架构和洋葱架构的规则。截至目前，整洁架构好像没有加入什么新鲜的概念。但是，在整洁架构示意图的右下角，还有一张小图&mldr;</p><h1 id=站在-mvc-和-ebi-的肩膀上>站在 MVC 和 EBI 的肩膀上</h1><p>整洁架构示意图的右下角的这张小图说明了控制流是如何工作的。这张小图并没还有提供太多信息，但博客中的说明和 Robert C. Martin 的会议演讲拓展了该话题。</p><p><img src=13-%E6%95%B4%E6%B4%81%E6%9E%B6%E6%9E%84.assets/4099-f804650ec79cd41b.png alt=img></p><p>我们在上图的左侧看到的是 MVC 中的视图和控制器。双实线另一层的所有形状都是 MVC 中的模型。这些模型也代表着 EBI 架构(我们可以清楚的看到边界、交互器和实体)，六边形架构中的“应用”、洋葱架构中的“应用核心”，以及前面整洁架构示意图中的“实体”层和“用例”层。</p><p>假设有一个 HTTP 请求按照控制流到达了控制器。控制器接下来会：</p><ol><li>拆解请求；</li><li>使用相关数据创建一个请求模型；</li><li>执行交互器(作为交互器接口的，即边界的，实例被注入到控制器中)中的方法并将请求模型传递给它；</li><li>交互器会：<br>4.1 使用实体网关实现(作为实体网关接口的实例被注入到交互器中)查找相关实体；<br>4.2 编排实体之间的交互；<br>4.3 用操作的数据结果创建响应模型；<br>4.4 将响应模型交给展示器进行填充；<br>4.5 将展示器返回给控制器；</li><li>使用展示器生成视图模型；</li><li>将视图模型绑定到视图；</li><li>将视图返回给客户端。</li></ol><p>这里只有“展示器”的用法我有些疑问，我在项目中的实际做法和这里不太一样。我会某种 DTO 类型的数据返回给交互器，而不是注入一个填充了数据的展示器对象。</p><p>我通常会采用实际上是一种 MVP 实现，控制器在其中负责从客户端接收数据并响应它。</p><h1 id=总结>总结</h1><p>我不认为整洁架构是革命性的，因为它实际上并没有带来突破性的概念或模式。</p><p>但是，我认为它是相当重要的成果：</p><ul><li>它发掘了某种程度上被遗忘了的概念、规则和模式；</li><li>它澄清了一些实用且重要的概念、规则和模式；</li><li>它告诉我们如何把所有的概念、规则和模式整合起来，形成一种构建复杂应用并保持可维护性的标准套路</li></ul><p>Uncle Bob 关于整洁架构的工作总会让我想起牛顿。引力始终是存在的，每个人都知道松手让苹果远离地面的高处落下，它会落向地面。牛顿做的事情“只不过”是写了一篇论文披露这个事实。这件事请很“简单”，但却让人们开始思考它并基于它创造更新的想法。</p><p>换句话说，我认为 Robert C. Martin 就是软件开发领域的牛顿！</p><h1 id=引用来源>引用来源</h1><p>2012 – Robert C. Martin –
<a href=https://youtu.be/Nltqi7ODZTM target=_blank>Clean Architecture (NDC 2012)</a><br>2012 – Robert C. Martin –
<a href=https://blog.8thlight.com/uncle-bob/2012/08/13/the-clean-architecture.html target=_blank>The Clean Architecture</a><br>2012 – Benjamin Eberlei –
<a href=https://beberlei.de/2012/08/13/oop_business_applications_entity_boundary_interactor.html target=_blank>OOP Business Applications: Entity, Boundary, Interactor</a><br>2017 – Lieven Doclo –
<a href=https://www.insaneprogramming.be/article/2017/02/14/thoughts-on-clean-architecture/ target=_blank>A couple of thoughts on Clean Architecture</a><br>2017 – Grzegorz Ziemoński –
<a href=https://dzone.com/articles/clean-architecture-is-screaming target=_blank>Clean Architecture Is Screaming</a></p><p><strong>我知道牛顿爵士的成就远不止这些，但我只想强调我认为 Robert C. Martin 的观点到底有多重要。</strong></p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>p3p3pp3</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-05-16</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/architecture.html>architecture</a></div><nav class=post-nav><a class=prev href=/post/2021/software-architecture/14-%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E7%9A%84%E6%9E%B6%E6%9E%84.html><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">14.事件驱动的架构</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2021/software-architecture/12-%E6%B4%8B%E8%91%B1%E6%9E%B6%E6%9E%84.html><span class="next-text nav-default">12.洋葱架构</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="p3sblog",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=https://p3p3pp3.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次</span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人</span></div><span class=copyright-year>&copy;
2017 -
2023<span class=heart><i class="iconfont icon-heart"></i></span><span>p3p3pp3</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-134997356-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>