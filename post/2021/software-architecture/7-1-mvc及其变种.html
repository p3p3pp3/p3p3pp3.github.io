<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>7.1.MVC及其变种 - P3的Blog</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="p3p3pp3"><meta name=description content="原文： https://herbertograca.com/2017/08/17/mvc-and-its-variants/ 这篇文章是 软件架构编年史( 译)的一部分，这部编年史由 一系列关于软件架构的文章组成。在这一系列文章中，我将写下我对软件架构的学习和思考"><meta name=keywords content="P3,blog,coding"><meta name=baidu-site-verification content="code-rMlGvJbrZW"><meta name=google-site-verification content="iTJj3dp57yfylJL_-Z2_nwxz5Dz6jnf1xAwgKb6TS_g"><meta name=generator content="Hugo 0.109.0 with theme even"><link rel=canonical href=https://p3p3pp3.github.io/post/2021/software-architecture/7-1-mvc%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.html><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="7.1.MVC及其变种"><meta property="og:description" content="原文： https://herbertograca.com/2017/08/17/mvc-and-its-variants/ 这篇文章是 软件架构编年史( 译)的一部分，这部编年史由 一系列关于软件架构的文章组成。在这一系列文章中，我将写下我对软件架构的学习和思考"><meta property="og:type" content="article"><meta property="og:url" content="https://p3p3pp3.github.io/post/2021/software-architecture/7-1-mvc%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.html"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-16T13:56:51+08:00"><meta property="article:modified_time" content="2021-05-16T13:56:51+08:00"><meta itemprop=name content="7.1.MVC及其变种"><meta itemprop=description content="原文： https://herbertograca.com/2017/08/17/mvc-and-its-variants/ 这篇文章是 软件架构编年史( 译)的一部分，这部编年史由 一系列关于软件架构的文章组成。在这一系列文章中，我将写下我对软件架构的学习和思考"><meta itemprop=datePublished content="2021-05-16T13:56:51+08:00"><meta itemprop=dateModified content="2021-05-16T13:56:51+08:00"><meta itemprop=wordCount content="3646"><meta itemprop=keywords content="architecture,MVC,"><meta name=twitter:card content="summary"><meta name=twitter:title content="7.1.MVC及其变种"><meta name=twitter:description content="原文： https://herbertograca.com/2017/08/17/mvc-and-its-variants/ 这篇文章是 软件架构编年史( 译)的一部分，这部编年史由 一系列关于软件架构的文章组成。在这一系列文章中，我将写下我对软件架构的学习和思考"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>P3的Blog</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post.html><li class=mobile-menu-item>Archives</li></a><a href=/tags.html><li class=mobile-menu-item>Tags</li></a><a href=/categories.html><li class=mobile-menu-item>Categories</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>P3的Blog</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post.html>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags.html>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories.html>Categories</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>7.1.MVC及其变种</h1><div class=post-meta><span class=post-time>2021-05-16</span>
<span class=more-meta>约 3646 字</span>
<span class=more-meta>预计阅读 8 分钟</span>
<span id=busuanzi_container_page_pv class=more-meta><span id=busuanzi_value_page_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次阅读</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#1979--model-view-controller>1979 – Model-View-Controller</a></li><li><a href=#19872000--pachierarchical-model-view-controller>1987/2000 – PAC/Hierarchical Model-View-Controller</a></li><li><a href=#1996--model-view-presenter>1996 – Model-View-Presenter</a></li><li><a href=#2005--model-view-viewmodel>2005 – Model-View-ViewModel</a></li><li><a href=#model-view-presenter-viewmodel>Model-View-Presenter-ViewModel</a></li><li><a href=#总结>总结</a></li><li><a href=#引用来源>引用来源</a></li></ul></nav></div></div><div class=post-content><p>原文：
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fherbertograca.com%2F2017%2F08%2F17%2Fmvc-and-its-variants%2F" target=_blank>https://herbertograca.com/2017/08/17/mvc-and-its-variants/</a></p><p><em>这篇文章是
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fherbertograca.com%2F2017%2F07%2F03%2Fthe-software-architecture-chronicles%2F" target=_blank>软件架构编年史</a>(
<a href=https://www.jianshu.com/p/b477b2cc6cfa target=_blank>译</a>)的一部分，这部编年史由
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fherbertograca.com%2Fcategory%2Fdevelopment%2Fseries%2Fsoftware-architecture%2F" target=_blank>一系列关于软件架构的文章</a>组成。在这一系列文章中，我将写下我对软件架构的学习和思考，以及我是如何运用这些知识的。如果你阅读了这个系列中之前的文章，本篇文章的的内容将更有意义。</em></p><p>创建可维护的应用始终是构建应用的真正的长期挑战。</p><p>不久以前，我还为一家公司工作过，其核心业务应用是拥有数千家公司客户的 SaaS 平台。这个至关重要的应用已经开发了三年，代码文件中混杂着 HTML、CSS、业务逻辑和 SQL。果然，在发布两年之后，公司决定完全重写这个应用。尽管这些情况时有发生，但如今我们许多人都知道这是不对的以及该如何避免。</p><p>然而，在20世纪70年代，职责混杂还是常见的实践，人们还在寻找更好的解决办法。随着应用程序复杂度的增长，修改 UI 必然也会引起业务逻辑的修改，修改越发复杂，耗费的时间也越来越多，还可能带来更多的问题(因为修改的代码更多了)。</p><p>MVC 因此应运而生，它提出前端和后端之间的“关注点分离”来解决上述问题。</p><h1 id=1979--model-view-controller>1979 – Model-View-Controller</h1><p><img src=7-1-MVC%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.assets/4099-c6939a3ff18f8b83.jpg alt=img></p><p>为了解决上述问题，
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fheim.ifi.uio.no%2F~trygver%2F1979%2Fmvc-2%2F1979-12-MVC.pdf" target=_blank>Trygve Reenskaug 于1979 年提出了 MVC 模式</a>来分离关注点，将 UI 和业务逻辑隔离。该模式当时被应用于
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHistory_of_the_graphical_user_interface%23Xerox_PARC" target=_blank>1973 就已经出现的桌面图形界面</a>的开发。</p><p>MVC 模式将代码拆分成了三个概念单元：</p><ul><li>代表业务逻辑的 Model (模型)；</li><li>代表 UI 控件的 View (视图)：按钮、文本框等等；</li><li>在视图和模型之间居中协调的 Controller(控制器)，这意味着:<ul><li>它决定显示哪些视图以及哪些数据；</li><li>它将用户操作(例如点击按钮)转换成业务逻辑。</li></ul></li></ul><blockquote><p>模型可以是单个对象(相当无趣)，也可以是对象组成的某种结构。——Trygve Reenskaug 1979,
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fheim.ifi.uio.no%2F~trygver%2F1979%2Fmvc-2%2F1979-12-MVC.pdf" target=_blank>MVC</a></p></blockquote><p>最初的 MVC 模式还有其它一些需要了解的的重要概念：</p><ol><li>View 直接使用 Model 数据对象来展示数据；</li><li>当 Model 发生变化时，会触发一个事件立即更新 View(记住，1979年还没有 HTTP)；</li><li>每一个 View 通常只关联一个 Controller；</li><li>每个界面可以包含多对 View 和 Controller；</li><li>每个Controller 可以对应多个 View。</li></ol><p>现在我所熟知的 HTTP 请求响应范式并没有使用最初的 MVC 风格。这是因为，按照原始的设想，数据从 View 流向 Controller，这和我熟悉的一样，但另一边，数据直接从 Model 流向 View，并没有经过 Controller。</p><p>而且，在现在的请求响应范式中，当数据库中的数据发生变化时，并不会触发浏览器中展示 View 的更新(尽管可以用 Web Socket 实现)。要看到更新后的数据，用户需要发起一次新的请求，而更新的数据总是会通过 Controller 返回。</p><h1 id=19872000--pachierarchical-model-view-controller>1987/2000 – PAC/Hierarchical Model-View-Controller</h1><p><img src=7-1-MVC%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.assets/4099-740caabe37c791a2.png alt=img></p><p>PAC 又称 HMVC，在 UI 片段***控件化***的上下文中它能带来更好的模块化拆分。</p><p>例如，我们会发现 View 的一部分被其它一些 View 以同样的格式使用，甚至直接就在同一个 View 重复使用。一个实际的例子就是网页展现 RSS 订阅内容的片段，它可以被其它页面重用。</p><p>如果使用 HMVC，处理主请求的 Controller 会将子请求转发给其它 Controller 让这些控件进行渲染，然后在主 View 的渲染中合并它们。</p><p>在 HTTP 请求/响应范式的上下文里，我自己也曾遇到过几次这种情况，但我发现了一个更简单的方法，即让 UI 向可以渲染控件的 Controller 发起 AJAX 调用。在保持模块化优势的同时并没有增加嵌套 Controller 调用带来的复杂性，另一个优势就是这些子请求可以使用像 Varnish 这样的缓存。</p><h1 id=1996--model-view-presenter>1996 – Model-View-Presenter</h1><p><img src=7-1-MVC%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.assets/4099-547ec01204407a2d.jpg alt=img></p><p>MVC 模式给当时的编程范式注入了一剂强心针。然而，随着应用程序复杂度的增加，需要更进一步地解耦。</p><p>1996 年，IBM 的子公司 Taligent 公开了他们基于 MVC 的 模式 MVP。其思想是将 Model 对 UI 的关注更彻底地分离：</p><ul><li>View 是被动的，对 Model 无感知；</li><li>专注于轻量 Controller(Presenter)，它们不包含任何业务逻辑，只是简单地调用命令和/或查询模型，将原始数据传递给 View；</li><li>数据的变化不会直接触发 View 的更新：它始终要通过 Presenter，由 Presenter 来更新 View。这样在更新视图之前 Controller(Presenter) 还可以执行一些和展现相关的额外逻辑。例如，同时更新另一些数据，它们和数据库中发生变化的数据有关；</li><li>每个 View 对应一个 Presenter。</li></ul><p>这更接近我所见到的现在的请求/响应范式：<strong>数据流始终要经过 Controller/Presenter</strong>。不过，Presenter 仍然不会主动更新视图，它始终需要执行一次新的请求才能让变化可见，。</p><p>MVP 中的 Presenter 又被称为
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FSupervisingPresenter.html" target=_blank>Supervisor Controller</a>。</p><h1 id=2005--model-view-viewmodel>2005 – Model-View-ViewModel</h1><p><img src=7-1-MVC%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.assets/4099-231d6c9049a4476a.jpg alt=img></p><p>由于应用程序的复杂性还在增加，2005 年微软的 WPF 和 Silverlight 架构师
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fjohngossman%2F2005%2F10%2F08%2Fintroduction-to-modelviewviewmodel-pattern-for-building-wpf-apps%2F" target=_blank>John Gossman 又提出了 MVVM 模式</a>，目标是进一步将 UI 设计从代码中分离出来，并提供 View 到数据模型的数据绑定机制。</p><blockquote><p>[MVVM] 是 [MVC] 的变种，专为现代 UI 开发平台设计。现代 UI 开发中，View 是由设计师负责而不是由传统意义上的开发者负责。[…] 开发应用程序 UI 使用的工具、语言以及使用它们的人都和业务逻辑以及数据后端有着天壤之别。——John Gossman 2005,
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fjohngossman%2F2005%2F10%2F08%2Fintroduction-to-modelviewviewmodel-pattern-for-building-wpf-apps%2F" target=_blank>Introduction to Model/View/ViewModel pattern</a></p></blockquote><p>Controller 被 ViewModel “取代”：</p><blockquote><p>[View] 对键盘快捷键进行编码，而且控件自行管理与输入设备的交互，这本该是 MVC 中的 Controller 的职责(现代 GUI 开发中 Controller 的变化说来话长&mldr;我认为它只是淡出了开发者的实现。它始终都存在着，而我们不需要像1979年那样去思考它)。——John Gossman 2005,
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fjohngossman%2F2005%2F10%2F08%2Fintroduction-to-modelviewviewmodel-pattern-for-building-wpf-apps%2F" target=_blank>Introduction to Model/View/ViewModel pattern</a></p></blockquote><p>MVVM 背后的思想是:</p><ul><li>ViewModel 和 View 一一对应；</li><li>将 View 中的逻辑转移到 ViewModel 来简化 View；</li><li>View 使用的数据和 ViewModel 中的数据一一对应；</li><li>将 ViewModel 中的数据绑定到 View 中的数据上，这样 ViewModel 中数据的变化会立即体现在 View 上。</li></ul><p>和最初的 MVC 模式的情况相仿，对传统的请求/响应范式来说这种方法是行不通的，因为 ViewModel 无法主动地更新 View(除非使用 Web Socket)，而 MVVM 对这一点是有要求的。还有，根据我的经验，ViewModel 的属性和 View 使用的数据做到完全匹配并不是 Controller 的常见实践。</p><h1 id=model-view-presenter-viewmodel>Model-View-Presenter-ViewModel</h1><p><img src=7-1-MVC%E5%8F%8A%E5%85%B6%E5%8F%98%E7%A7%8D.assets/4099-278f26a042d54ee3.png alt=img></p><p>当构建云原生的复杂企业应用时，我倾向于将应用的 UI 结构合理地设计成 M-V-P-VM，这里的 View Model 是 Martin Fowler 在 2004 年提出的
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FPresentationModel.html" target=_blank>Presentation Model</a>,。</p><ul><li><p><strong>Model</strong></p><p>一组包含业务逻辑和用例的类。</p></li><li><p><strong>View</strong></p><p>一个模板，模板引擎用它来生成 HTML；</p></li><li><p><strong>ViewModel(又叫做
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FPresentationModel.html" target=_blank>Presentation Model</a>)</strong></p><p>从查询中接收(或者从 Model 实体中提取)原始数据，持有这些会模板会用到的数据。它还要封装复杂的展现逻辑，来简化模板。我发现运用 ViewModel 十分重要，因为我们绝不会想在模板中使用实体。这样我们才能将 View 和 Model 完全隔离开：</p><ul><li>Model 中的变化(比如实体结构的变化)会上升并影响 ViewModel，但不会影响模板；</li><li>复杂的展现逻辑被封装到了 ViewModel 之中，因此不会被泄露(例如，在业务实体中创建一些只和展现逻辑有关的方法)到领域之中；</li><li>模板的依赖变得很清晰，因为它们必须在 ViewModel 中设置。例如，暴露出依赖可以帮助我们决定应该优先从数据库中加载哪些内容来避免 N+1 问题。</li></ul></li><li><p><strong>Presenter</strong></p><p>接收 HTTP 请求，触发命令或查询，使用查询返回的数据、ViewModel、模板和模板引擎生成 HTML 并将它返回给客户端。所有 View 的交互都要经过 Presenter。</p></li></ul><p>下面是我实现的一个非常简单的例子：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=c1>// src/UI/Admin/Some/Controller/Namespace/Detail/SomeEntityDetailController.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=nx>UI\Admin\Some\Controller\Namespace\Detail</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// use ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>final</span> <span class=k>class</span> <span class=nc>SomeEntityDetailController</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var SomeRepositoryInterface
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$someRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var RelatedRepositoryInterface
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$relatedRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var TemplateEngineInterface
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$templateEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span>
</span></span><span class=line><span class=cl>        <span class=nx>SomeRepositoryInterface</span> <span class=nv>$someRepository</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>RelatedRepositoryInterface</span> <span class=nv>$relatedRepository</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=nx>TemplateEngineInterface</span> <span class=nv>$templateEngine</span>
</span></span><span class=line><span class=cl>    <span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>someRepository</span> <span class=o>=</span> <span class=nv>$someRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>relatedRepository</span> <span class=o>=</span> <span class=nv>$relatedRepository</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>templateEngine</span> <span class=o>=</span> <span class=nv>$templateEngine</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @return mixed
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>get</span><span class=p>(</span><span class=nx>int</span> <span class=nv>$someEntityId</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$mainEntity</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>someRepository</span><span class=o>-&gt;</span><span class=na>getById</span><span class=p>(</span><span class=nv>$someEntityId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=nv>$relatedEntityList</span> <span class=o>=</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>relatedRepository</span><span class=o>-&gt;</span><span class=na>getByParentId</span><span class=p>(</span><span class=nv>$someEntityId</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>templateEngine</span><span class=o>-&gt;</span><span class=na>render</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;@Some/Controller/Namespace/Detail/details.html.twig&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=k>new</span> <span class=nx>DetailsViewModel</span><span class=p>(</span><span class=nv>$mainEntity</span><span class=p>,</span> <span class=nv>$relatedEntityList</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgist.github.com%2Fhgraca%2Fea2473a0d83a8fd70718b412870881c2%2Fraw%2Fc48d3af6c0418e1d6aa119daa2ce7a2773080b97%2FM-V-C-VM_-_Controller_example.php" target=_blank>M-V-C-VM_-_Controller_example.php</a></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=c1>// src/UI/Admin/Some/Controller/Namespace/Detail/DetailsViewModel.php
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>namespace</span> <span class=nx>UI\Admin\Some\Controller\Namespace\Detail</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// use ...
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>final</span> <span class=k>class</span> <span class=nc>DetailsViewModel</span> <span class=k>implements</span> <span class=nx>TemplateViewModelInterface</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$mainEntity</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var array
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$relatedEntityList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var bool
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$shouldDisplayFancyDialog</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @var bool
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>private</span> <span class=nv>$canEditData</span> <span class=o>=</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=sd>/**
</span></span></span><span class=line><span class=cl><span class=sd>     * @param SomeEntity $mainEntity
</span></span></span><span class=line><span class=cl><span class=sd>     * @param RelatedEntity[] $relatedEntityList
</span></span></span><span class=line><span class=cl><span class=sd>     */</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=fm>__construct</span><span class=p>(</span><span class=nx>SomeEntity</span> <span class=nv>$mainEntity</span><span class=p>,</span> <span class=k>array</span> <span class=nv>$relatedEntityList</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>mainEntity</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;name&#39;</span> <span class=o>=&gt;</span> <span class=nv>$mainEntity</span><span class=o>-&gt;</span><span class=na>getName</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;description&#39;</span> <span class=o>=&gt;</span> <span class=nv>$mainEntity</span><span class=o>-&gt;</span><span class=na>getResume</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=k>foreach</span> <span class=p>(</span><span class=nv>$relatedEntityList</span> <span class=k>as</span> <span class=nv>$relatedEntity</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>relatedEntityList</span><span class=p>[]</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;title&#39;</span> <span class=o>=&gt;</span> <span class=nv>$relatedEntity</span><span class=o>-&gt;</span><span class=na>getTitle</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;subtitle&#39;</span> <span class=o>=&gt;</span> <span class=nv>$relatedEntity</span><span class=o>-&gt;</span><span class=na>getSubtitle</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=p>];</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>shouldDisplayFancyDialog</span> <span class=o>=</span> <span class=cm>/* ... some complex conditional using the entities data ... */</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>canEditData</span> <span class=o>=</span> <span class=cm>/* ... another complex conditional using the entities data ... */</span> <span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getMainEntity</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>mainEntity</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>getRelatedEntityList</span><span class=p>()</span><span class=o>:</span> <span class=k>array</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>relatedEntityList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>shouldDisplayFancyDialog</span><span class=p>()</span><span class=o>:</span> <span class=nx>bool</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>shouldDisplayFancyDialog</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>canEditData</span><span class=p>()</span><span class=o>:</span> <span class=nx>bool</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nv>$this</span><span class=o>-&gt;</span><span class=na>canEditData</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgist.github.com%2Fhgraca%2Fea2473a0d83a8fd70718b412870881c2%2Fraw%2Fc48d3af6c0418e1d6aa119daa2ce7a2773080b97%2FM-V-C-VM_-_ViewModel_example.php" target=_blank>M-V-C-VM_-_ViewModel_example.php</a></p><p>模板和 ViewModel 一一对应，意味着 View 只能被一个特定的 ViewModel 使用，反过来也一样。这会让我进一步思考，也许<strong>我们可以将模板和 ViewModel 封装成一个 View 对象，更有效地将 Controller 和模板以及 ViewModel 解耦</strong>，让它只依赖一个通用的 View 接口；但我还没有机会实验这个想法。</p><h1 id=总结>总结</h1><p>在网上，我们还能找到其它 MVC 的变种。但是，这里列出是我觉得更有意义和/或与我的工作有关的一些模式。</p><p>然而，我在本文中引用的这些模式是为桌面应用程序和/或富客户端的上下文创建的，因此它们不是总能和请求/响应范式百分之百的匹配。</p><p>如果你开发的是云原生的企业应用并且使用了 MVC，实际上你多半使用的是更接近 MVP 的某种模式。但无论如何，我想表达的不是应该尊崇某种特定的 MVC 变种或是刻板地理解它们的名字，而是我们应该<strong>学习所有的模式，按照需要去使用和调整它们</strong>。还是那句老话，最终目标就是<strong>高内聚低耦合</strong>：<strong>关注点分离</strong>。</p><h1 id=引用来源>引用来源</h1><p>1979 – Trygve Reenskaug –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fheim.ifi.uio.no%2F~trygver%2Fthemes%2Fmvc%2Fmvc-index.html" target=_blank>MVC XEROX PARC 1978-79</a><br><strong>1979 – Trygve Reenskaug –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fheim.ifi.uio.no%2F~trygver%2F1979%2Fmvc-2%2F1979-12-MVC.pdf" target=_blank>MVC</a></strong><br><strong>1987 – Joelle Coutaz –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fwww.lri.fr%2F~mbl%2FENS%2FFONDIHM%2F2013%2Fpapers%2FCoutaz-Interact87.pdf" target=_blank>PAC, an Object Oriented Model for Dialog Design</a></strong><br><strong>1996 – Mike Potel –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.wildcrest.com%2FPotel%2FPortfolio%2Fmvp.pdf" target=_blank>MVP: Model-View-Presenter: The Taligent Programming Model for C++ and Java</a></strong><br>2000 – Jason Cai, Ranjit Kapila, Gaurav Pal –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fwww.javaworld.com%2Farticle%2F2076128%2Fdesign-patterns%2Fhmvc--the-layered-pattern-for-developing-strong-client-tiers.html" target=_blank>HMVC: The layered pattern for developing strong client tiers</a><br>2003 -Trygve Reenskaug –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fheim.ifi.uio.no%2F~trygver%2F2003%2Fjavazone-jaoo%2FMVC_pattern.pdf" target=_blank>The Model-View-Controller (MVC): Its Past and Present</a><br><strong>2004 -Martin Fowler –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FPresentationModel.html" target=_blank>Presentation Model</a></strong><br><strong>2005 – John Gossman –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fblogs.msdn.microsoft.com%2Fjohngossman%2F2005%2F10%2F08%2Fintroduction-to-modelviewviewmodel-pattern-for-building-wpf-apps%2F" target=_blank>Introduction to Model/View/ViewModel pattern for building WPF apps</a></strong><br>2006 – Martin Fowler –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FSupervisingPresenter.html" target=_blank>Supervising Controller</a><br><strong>2006 – Martin Fowler –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fmartinfowler.com%2FeaaDev%2FuiArchs.html" target=_blank>GUI Architectures</a></strong><br>2011 – Mārtiņš Tereško –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fstackoverflow.com%2Fquestions%2F7621832%2Farchitecture-more-suitable-for-web-apps-than-mvc%2F7622038%237622038" target=_blank>Architecture more suitable for web apps than MVC?</a><br>2017* – Tracy-Gregory J. Gilmore –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fgilmoretj.wordpress.com%2Fmusings-on-all-things-ria%2Fnever-the-twain-shall-meet-the-tale-of-mv%2F" target=_blank>Never the twain shall meet. The tale of MV*</a><br>2017* – Tech notes –
<a href="https://links.jianshu.com/go?to=http%3A%2F%2Fdodgenotes.blogspot.nl%2F2013%2F12%2Fmvvm-vs-mvp-vs-mvc-differences-explained.html" target=_blank>MVVM vs MVP vs MVC: The differences explained</a><br>2017* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FModel%E2%80%93view%E2%80%93controller" target=_blank>Model–view–controller</a><br>2017* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FPresentation%E2%80%93abstraction%E2%80%93control" target=_blank>Presentation–abstraction–control</a><br>2017* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FModel%E2%80%93view%E2%80%93presenter" target=_blank>Model-view-presenter</a><br>2017* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FHierarchical_model%E2%80%93view%E2%80%93controller" target=_blank>Hierarchical model–view–controller</a><br>2017* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.m.wikipedia.org%2Fwiki%2FModel%E2%80%93view%E2%80%93viewmodel" target=_blank>Model–view–viewmodel</a><br>2018* – Wikipedia –
<a href="https://links.jianshu.com/go?to=https%3A%2F%2Fen.wikipedia.org%2Fwiki%2FHistory_of_the_graphical_user_interface%23Xerox_PARC" target=_blank>History of the graphical user interface</a></p></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>p3p3pp3</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2021-05-16</span></p></div><footer class=post-footer><div class=post-tags><a href=/tags/architecture.html>architecture</a>
<a href=/tags/mvc.html>MVC</a></div><nav class=post-nav><a class=prev href=/post/2021/software-architecture/7-1-model1-model2.html><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">7.1.Model1&Model2</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/post/2021/software-architecture/6-%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84.html><span class="next-text nav-default">6.分层架构</span>
<span class="next-text nav-mobile">下一篇</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname==="localhost")return;var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="p3sblog",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=https://p3p3pp3.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>由 <a class=hexo-link href=https://gohugo.io>Hugo</a> 强力驱动</span>
<span class=division>|</span>
<span class=theme-info>主题 -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span><div class=busuanzi-footer><span id=busuanzi_container_site_pv>本站总访问量 <span id=busuanzi_value_site_pv><img src=/img/spinner.svg alt=spinner.svg></span> 次</span>
<span class=division>|</span>
<span id=busuanzi_container_site_uv>本站总访客数 <span id=busuanzi_value_site_uv><img src=/img/spinner.svg alt=spinner.svg></span> 人</span></div><span class=copyright-year>&copy;
2017 -
2022<span class=heart><i class="iconfont icon-heart"></i></span><span>p3p3pp3</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script>
<script type=text/javascript>window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"}}</script><script async src=https://cdn.jsdelivr.net/npm/mathjax@3.0.5/es5/tex-mml-chtml.js integrity="sha256-HGLuEfFcsUJGhvB8cQ8nr0gai9EucOOaIxFw7qxmd+w=" crossorigin=anonymous></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-134997356-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script id=baidu_push>(function(){if(window.location.hostname==="localhost")return;var t,n,e=document.createElement("script");e.async=!0,n=window.location.protocol.split(":")[0],n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>